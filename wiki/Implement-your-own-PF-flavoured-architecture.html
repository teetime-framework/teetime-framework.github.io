
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2017-05-30
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Implement your own P&F flavoured architecture | TeeTime</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />
 
		<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet" />
		<link href="https://teetime-framework.github.io/css/docs.css" rel="stylesheet" />
		<link href="https://teetime-framework.github.io/css/reflow-skin.css" rel="stylesheet" />


		<link href="https://teetime-framework.github.io/css/lightbox.css" rel="stylesheet" />

		<link href="https://teetime-framework.github.io/css/site.css" rel="stylesheet" />
		<link href="https://teetime-framework.github.io/css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->


		
<script>window.twttr = (function(d, s, id) {
				var js, fjs =
				d.getElementsByTagName(s)[0],
				t = window.twttr || {};
				if
				(d.getElementById(id)) return t;
				js =
				d.createElement(s);
				js.id = id;
				js.src =
				"https://platform.twitter.com/widgets.js";
				fjs.parentNode.insertBefore(js, fjs);

				t._e = [];
				t.ready = function(f)
				{
				t._e.push(f);
				};
				return t;
				}(document, "script", "twitter-wjs"));</script>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/styles/xcode.min.css"/>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/highlight.min.js"></script>
<link sizes="57x57" rel="apple-touch-icon" href="https://teetime-framework.github.io/apple-touch-icon-57x57.png"/>
<link sizes="114x114" rel="apple-touch-icon" href="/apple-touch-icon-114x114.png"/>
<link sizes="72x72" rel="apple-touch-icon" href="https://teetime-framework.github.io/apple-touch-icon-72x72.png"/>
<link sizes="144x144" rel="apple-touch-icon" href="/apple-touch-icon-144x144.png"/>
<link sizes="60x60" rel="apple-touch-icon" href="https://teetime-framework.github.io/apple-touch-icon-60x60.png"/>
<link sizes="120x120" rel="apple-touch-icon" href="/apple-touch-icon-120x120.png"/>
<link sizes="76x76" rel="apple-touch-icon" href="https://teetime-framework.github.io/apple-touch-icon-76x76.png"/>
<link sizes="152x152" rel="apple-touch-icon" href="https://teetime-framework.github.io/apple-touch-icon-152x152.png"/>
<link sizes="180x180" rel="apple-touch-icon" href="https://teetime-framework.github.io/apple-touch-icon-180x180.png"/>
<meta name="apple-mobile-web-app-title" content="TeeTime"/>
<link sizes="192x192" rel="icon" href="https://teetime-framework.github.io/favicon-192x192.png" type="image/png"/>
<link sizes="160x160" rel="icon" href="https://teetime-framework.github.io/favicon-160x160.png" type="image/png"/>
<link sizes="96x96" rel="icon" href="https://teetime-framework.github.io/favicon-96x96.png" type="image/png"/>
<link sizes="16x16" rel="icon" href="https://teetime-framework.github.io/favicon-16x16.png" type="image/png"/>
<link sizes="32x32" rel="icon" href="https://teetime-framework.github.io/favicon-32x32.png" type="image/png"/>
<meta name="msapplication-TileColor" content="#2b5797"/>
<meta name="msapplication-TileImage" content="https://teetime-framework.github.io/mstile-144x144.png"/>
<meta name="application-name" content="TeeTime"/>
		<!-- Google Analytics -->
		<script type="text/javascript">

			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-72860916-1']);
			_gaq.push(['_trackPageview']);

			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();

		</script>
		</head>

	<body class="page-wiki-implement-your-own-pf-flavoured-architecture project-teetime" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="../">TeeTime</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="../download.html" title="Download">Download</a></li>
							<li ><a href="home.html" title="Wiki">Wiki</a></li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../stabledocs/index.html" title="JavaDoc">JavaDoc</a></li>
									<li ><a href="../changes-report.html" title="Release Notes">Release Notes</a></li>
									<li ><a href="../dependencies.html" title="Project Dependencies">Project Dependencies</a></li>
									<li ><a href="../license.html" title="License">License</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Get Involved <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../contribute.html" title="Contribute">Contribute</a></li>
									<li ><a href="https://github.com/teetime-framework/teetime" title="Visit us on GitHub" class="externalLink">Visit us on GitHub</a></li>
									<li ><a href="https://build.se.informatik.uni-kiel.de/gitlab/teetime/teetime/issues" title="Issue Tracking" class="externalLink">Issue Tracking</a></li>
									<li ><a href="../team-list.html" title="Team">Team</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<a href="https://teetime-framework.github.io/" id="bannerLeft"><h1><img src="https://teetime-framework.github.io/images/teetime-path.svg" id="logo"></h1></a>
					<p class="lead"><span class="slogan">The Next-Generation Pipe-and-Filter Framework</span></p>
				</div>
				<div class="pull-right">
				</div>
			</div>
		</div>
	</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span12">
			<div class="body-content">
<div class="section"> 
 <div class="page-header">
  <h2 id="Implement_your_own_PF_flavoured_architecture">Implement your own P&amp;F flavoured architecture</h2>
 </div> 
 <p>So… you want to use the TeeTime framework to implement your own P&amp;F architectures, eh? If you are reading this, you may expect some kind of step-by-step tutorial or such… and yes, this is the right place to look for it!</p> 
 <p>As a simple introduction, we will implement an architecture which counts all files in a given directory. In order to work with TeeTime you need to make sure it is added to your project. Further assistance on doing so can be found in the download section.</p> 
 <div class="section"> 
  <div class="section"> 
   <div class="section"> 
    <h5 id="Used_files_in_this_tutorial:">Used files in this tutorial:</h5> 
    <ul> 
     <li><a class="externalLink" href="https://build.se.informatik.uni-kiel.de/teetime/teetime/blob/master/src/test/java/teetime/examples/filecounter/DirReader.java">DirReader.java</a></li> 
     <li><a class="externalLink" href="https://build.se.informatik.uni-kiel.de/teetime/teetime/blob/master/src/test/java/teetime/examples/filecounter/FileCounter.java">FileCounter.java</a></li> 
     <li><a class="externalLink" href="https://build.se.informatik.uni-kiel.de/teetime/teetime/blob/master/src/test/java/teetime/examples/filecounter/ResultPrinter.java">ResultPrinter.java</a></li> 
     <li><a class="externalLink" href="https://build.se.informatik.uni-kiel.de/teetime/teetime/blob/master/src/test/java/teetime/examples/filecounter/PrintResultConfig.java">PrintResultConfig.java</a></li> 
    </ul> 
   </div> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Separate_that_Logic">Separate that Logic</h3> 
  <p>The Pipe&amp;Filter architecture is well known for its property to divide work into disjoint steps. As - for example - a car manufacturer which divides the assembly of a new car into different steps to increase efficiency and throughput, we will also follow this guideline in our work with TeeTime. So the first step is to analyze our program and divide it into different steps.</p> 
  <p>The steps of our “File Counter” can be summarised to:</p> 
  <p>At first, we look recursively for all nested directories, read each directory and pass all containing files one by one to the next processing step.<br />Next, we count all files by incrementing a counter upon each sent file.<br />The last stage will save or print the resulting number.</p> 
  <p>Our mission is to implement those four stages as separate filter and connect them.</p> 
 </div> 
 <div class="section"> 
  <h3 id="Implement_them_Stages">Implement them Stages</h3> 
  <p>This section will explain the implementation of the stages we need for our “File Counter”. If you want to dig deeper into the implementation mechanisms of the TeeTime framework, we recommend to take a look at <a href="Writing-your-own-Stage">this tutorial</a>.</p> 
  <p>Our first stage will be the <tt>DirReader</tt>. It visits all directories and sends all containing files to the next stage.<br />This is a perfect task to start working with TeeTime: implement this logic into a single stage. You may extend from <tt>teetime.framework.AbstractProducerStage</tt> and use its field <tt>outputPort</tt> to send elements to the next stage. Make sure you use <tt>terminate()</tt> after the stage is done with all its work, so that the framework knows the job is done.<br />A suitable solution can be found <a class="externalLink" href="https://build.se.informatik.uni-kiel.de/teetime/teetime/blob/master/src/test/java/teetime/examples/filecounter/DirReader.java">here</a>.</p> 
  <p>The next task is to implement the <tt>FileCounter</tt>. It receives elements of the type <tt>File</tt> and simply increments a counter upon each incoming element. <tt>teetime.framework.AbstractConsumerStage</tt> suits best this requirements. The counter only contains the correct result if the architecture is about to terminate. So make sure you override the method <tt>onTerminating()</tt> to send the final result.<br />One more hint: you may use <tt>createInputPort()</tt> or <tt>createOutputPort()</tt> to create additional ports.<br />Of course, there is also a <a class="externalLink" href="https://build.se.informatik.uni-kiel.de/teetime/teetime/blob/master/src/test/java/teetime/examples/filecounter/FileCounter.java">sample solution</a> for this part.</p> 
  <p>After all the hard work, we will finish everything by implementing the <tt>ResultPrinter</tt>. It receives elements of the type <tt>Integer</tt> and prints them to the console. As this is a simple consumer, <tt>teetime.framework.AbstractConsumerStage</tt> should also be used here.<br />This few lines of code may look like <a class="externalLink" href="https://build.se.informatik.uni-kiel.de/teetime/teetime/blob/master/src/test/java/teetime/examples/filecounter/ResultPrinter.java">this</a>.</p> 
 </div> 
 <div class="section"> 
  <h3 id="Connect_them_Stages">Connect them Stages</h3> 
  <p>What splendid stages we have, which await to be connected. Analogous to integrated circuits which are connected through their ports, we only need to connect the ports of the stages with pipes. For this purpose we can use the class <tt>teetime.framework.Configuration</tt>. We create instances of our three stages and connect them correctly. Please remember that TeeTime only supports uni-directed communication.<br />A sample solution can look like <a class="externalLink" href="https://build.se.informatik.uni-kiel.de/teetime/teetime/blob/master/src/test/java/teetime/examples/filecounter/PrintResultConfig.java">this</a>.</p> 
 </div> 
 <div class="section"> 
  <h3 id="TeeTime_Configuration_Builder">TeeTime Configuration Builder</h3> 
  <p>With the TeeTime configuration builder you can simply connect your stages in a short, type-safe, and fluent way. Typically, you create your configurations by instantiating all stages and connecting them via lines of <tt>connectPorts(...)</tt> calls.</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>public class MyConfiguration extends Configuration {

	public MyConfiguration(final List&lt;String&gt; strings) {
		final InitialElementProducer&lt;String&gt; producer = new InitialElementProducer&lt;&gt;(strings);
		final ToLowerCase toLowerCase = new ToLowerCase();
		final WordcharacterFilter wordcharacterFilter = new WordcharacterFilter();
		final WordCounter wordCounter = new WordCounter();
		final Printer&lt;CountingMap&lt;String&gt;&gt; printer = new Printer&lt;&gt;();

		this.connectPorts(producer.getOutputPort(), toLowerCase.getInputPort());
		this.connectPorts(toLowerCase.getOutputPort(), wordcharacterFilter.getInputPort());
		this.connectPorts(wordcharacterFilter.getOutputPort(), wordCounter.getInputPort());
		this.connectPorts(wordCounter.getOutputPort(), printer.getInputPort());
	}

}
</pre> 
   </div> 
  </div> 
  <p>With the TeeTime configuration builder you can simply connect the stages by calling <tt>from(...)</tt>, <tt>to(...)</tt>, and <tt>end(...)</tt>.</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>public MyConfiguration(final List&lt;String&gt; strings) {
	final InitialElementProducer&lt;String&gt; producer = new InitialElementProducer&lt;&gt;(strings);
	final ToLowerCase toLowerCase = new ToLowerCase();
	final WordcharacterFilter wordcharacterFilter = new WordcharacterFilter();
	final WordCounter wordCounter = new WordCounter();
	final Printer&lt;CountingMap&lt;String&gt;&gt; printer = new Printer&lt;&gt;();

	this.from(producer).to(toLowerCase).to(wordcharacterFilter).to(wordCounter).end(printer);
}
</pre> 
   </div> 
  </div> 
  <p>In addition to shorter and more expressive code, the configuration builder forces you to use every stage port exactly once. Furthermore, you do not have to declare all your stages as local variables if you do not need access to them.</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>public MyConfiguration(final List&lt;String&gt; strings) {
	this.from(new InitialElementProducer&lt;&gt;(strings))
		.to(new ToLowerCase())
		.to(new WordcharacterFilter())
		.to(new WordCounter())
		.end(new Printer&lt;&gt;());
}
</pre> 
   </div> 
  </div> 
  <p>If you do not need an own class for your configuration, you can create configurations straightforward by using the <tt>ConfigurationBuilder.from(...)</tt> method as shown in the next example. </p> 
  <div class="source"> 
   <div class="source"> 
    <pre>final Configuration myConfiguration = ConfigurationBuilder
				.from(new InitialElementProducer&lt;&gt;(strings))
				.to(new ToLowerCase())
				.to(new WordcharacterFilter())
				.to(new WordCounter())
				.end(new Printer&lt;&gt;());
</pre> 
   </div> 
  </div> 
  <p>You may want to use stages that do implement the <tt>ITransformation</tt> interface, for example, because they have multiple output ports like the <tt>InstanceOfFilter</tt>. For this case you an alternative form of the <tt>to(..)</tt> method, in which you can specify the stage&acute;s input and output port you want use. This is done via a lambda function as shown below.</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>final Configuration myConfiguration = ConfigurationBuilder
				.from(new MyProducerStage())
				.to(new MyFilterStage(), s -&gt; s.getMyInputPort(), s -&gt; s.getMyOutputPort())
				.end(new MyConsumerStage());
</pre> 
   </div> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Execute_that_Configuration">Execute that Configuration</h3> 
  <p>After all the hard work you may be way to excited to go to bed yet. To reap the fruits of your success you still need to execute the architecture.<br />As the caption of this section already spoils, we only need to instantiate the class <tt>teetime.framework.Execution</tt> and pass the desired <tt>Configuration</tt> to its constructor. Eventually call <tt>executeBlocking()</tt> and take a glance at your finished work. Following example is extracted from the sample solution of the section above:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>public static void main(final String... args) {
	PrintResultConfig config = new PrintResultConfig(new File(&quot;.&quot;));

	Execution&lt;PrintResultConfig&gt; execution = new Execution&lt;PrintResultConfig&gt;(config);
	execution.executeBlocking();
}
</pre> 
   </div> 
  </div> 
  <p>If everything is implemented correctly you should see the number of files in your console. If it shows up: Congrats!<br />Feel free to experiment with this configuration. For instance, you could save a file with the result in it instead of simply printing it. Introducing a stage which filters the files for a given name pattern would also be a nice exercise. There are endless of great things you can make with TeeTime… discover the explorer within you.</p> 
  <p><b>Note:</b> As of version 2.1, you are also able to run configurations from command line. To execute a configuration run the command <tt>java -cp ... teetime.framework.Execution your.own.Configuration</tt> where the classpath is set to the directory of the configuration and also the directory where TeeTime is located. In order to enable this feature you need also to add all dependencies to the classpath or you can simply make use of the provided <tt>teetime-…-jar-with-dependencies.jar</tt> file. This feature only allows to execute configurations without any arguments in their constructor. You can also run multiple configurations by adding them to the end of the command.</p> 
 </div> 
</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li >
							<a href="../index.html" title="Home">Home</a>
						</li>
						<li >
							<a href="../download.html" title="Download">Download</a>
						</li>
						<li >
							<a href="home.html" title="Wiki">Wiki</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Documentation</li>
						<li >
							<a href="../stabledocs/index.html" title="JavaDoc">JavaDoc</a>
						</li>
						<li >
							<a href="../changes-report.html" title="Release Notes">Release Notes</a>
						</li>
						<li >
							<a href="../dependencies.html" title="Project Dependencies">Project Dependencies</a>
						</li>
						<li >
							<a href="../license.html" title="License">License</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Get Involved</li>
						<li >
							<a href="../contribute.html" title="Contribute">Contribute</a>
						</li>
						<li >
							<a href="https://github.com/teetime-framework/teetime" title="Visit us on GitHub" class="externalLink">Visit us on GitHub</a>
						</li>
						<li >
							<a href="https://build.se.informatik.uni-kiel.de/gitlab/teetime/teetime/issues" title="Issue Tracking" class="externalLink">Issue Tracking</a>
						</li>
						<li >
							<a href="../team-list.html" title="Team">Team</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<blockquote><a class="twitter-follow-button" data-show-count="false" href="https://twitter.com/TeeTime_Fwrk">Follow @TeeTime_Fwrk</a>
				<br />
				Snapshot state:
				<br />
				<a href="https://build.se.informatik.uni-kiel.de/jenkins/view/TeeTime/job/teetime-nightly-release/"><img alt="Jenkins build status" src="https://img.shields.io/jenkins/s/https/build.se.informatik.uni-kiel.de/jenkins/view/TeeTime/job/teetime-nightly-release.svg?style=flat-square"></a>
				<br />
				<a href="https://build.se.informatik.uni-kiel.de/jenkins/view/TeeTime/job/teetime-nightly-release/lastCompletedBuild/testReport/"><img alt="Jenkins build status" src="https://img.shields.io/jenkins/t/https/build.se.informatik.uni-kiel.de/jenkins/view/TeeTime/job/teetime-nightly-release.svg?style=flat-square"></a>
				<br />Stable state:
				<br />
				<a href="https://github.com/teetime-framework/teetime/releases/latest" rel="nofollow"><img alt="Download TeeTime" src="https://img.shields.io/badge/GitHub-v2.1-blue.svg?style=flat-square"></a>
				<br />
				<a href="http://search.maven.org/#search%7Cgav%7C1%7Cg%3A%22net.sourceforge.teetime%22%20AND%20a%3A%22teetime%22"><img alt="Download TeeTime" src="https://img.shields.io/maven-central/v/net.sourceforge.teetime/teetime.svg?style=flat-square"></a></blockquote>
					<blockquote class="version-date"><span class="publishDate">Last Published: 2017-05-30</span></blockquote>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2015-2017. All Rights Reserved.</p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="https://teetime-framework.github.io/js/lightbox.min.js"></script>
	<script src="https://teetime-framework.github.io/js/reflow-scroll.js"></script>
	
<script src="https://teetime-framework.github.io/js/jquery.cookiesdirective.js"></script>
<script src="https://teetime-framework.github.io/js/teetime.js"></script>
	<script src="https://teetime-framework.github.io/js/reflow-skin.js"></script>

	</body>
</html>
